{% extends "base.html" %}
{% block css %}
  <style>
    .hidden_fields, #asset_forms, .image_form{display: none;}
    .asset{float: left;}
    .description{height: 5em;}

    #artisan_formset, #product_formset, #tool_formset, #material_formset{
      border: 5px solid gray;
    }
    .asset ul{list-style: none; text-align: center}
    .asset ul li{padding: 0}
    .asset ul li.asset_image{
      width: 200px;
      height: 200px;
      padding: 3px;
      margin: 0 auto 10px;
      border: 2px solid #F0F0F0;
    }

  </style>
  <link href="{{ STATIC_URL }}ajaxuploader/css/fileuploader.css" media="screen" rel="stylesheet" type="text/css" />
{% endblock css%}

{% block javascript %}
  {% load url from future %}
  <script type='text/javascript'>
    $().ready( function(){
      $('.asset_image').attr('id','file-uploader');//make this a file-uploader box
      initializeFileUploader();
    });

    function initializeFileUploader(){
    var uploader = new qq.FileUploader({
      action: "{% url 'seller:image upload' %}",
      element: $('#file-uploader')[0],
      multiple: true,
      onComplete: function(id, fileName, responseJSON) {
        if(responseJSON.success) {
          alert("success!");
        } else {
          alert("upload failed!");
        }
      },
      onAllComplete: function(uploads) {
        // uploads is an array of maps
        // the maps look like this: {file: FileObject, response: JSONServerResponse}
        alert("All complete!");
      },
      params: {
        'csrf_token': '{{ csrf_token }}',
        'csrf_name': 'csrfmiddlewaretoken',
        'csrf_xname': 'X-CSRFToken',
      },
    });
  }
  </script>
  <script src="{{ STATIC_URL }}javascript/seller/account_edit.js"></script>
  <script src="{{ STATIC_URL }}ajaxuploader/js/fileuploader.js" ></script>
{% endblock javascript%}

{% block content %}
  {% load url from future %}
  <h1 id='title'>Seller Account</h1>

  {% if form.errors %}
    <p style="color: red;">
      Please correct the error{{ form.errors|pluralize }} below.
    </p>
  {% endif %}

  <form action="" method="post">{% csrf_token %}
    <div id='seller_form'>
      <table>{{ seller_form.as_table }}</table>
      <!--<button type="submit">OK!</button>-->
    </div>
  </form>

  {% load image_tags %}

  <div id='asset_forms'>
    <div class='asset'>
      <form action='{{ image_form.action }}' class='image_form'>
        {{ image_form }}
      </form>
      <form>
        <div class='hidden_fields'>
          {{ asset_form.ilk }}
          {{ asset_form.image }}
          {{ asset_form.DELETE }}
        </div>
        <ul>
          <li class='asset_image'>
            {% image asset_form.image.value %}
          </li>
          <li>{{ asset_form.name }}</li>
          <li>{{ asset_form.description }}</li>
          <li class='asset_category'>
            {% if 'admin_id' in request.session %}
              {{ asset_form.category }}
            {% endif %}
          </li>
        </ul>
      </form>
    </div>
  </div>

  <ul id='asset_tabs'>
    {% for asset_ilk in asset_ilks %}
      <li id='{{ asset_ilk }}_tab' class='asset_tab'>
        <a href='#{{ asset_ilk }}_tab'>{{ asset_ilk|title }}{{ 2|pluralize }}</a>
      </li>
    {% endfor %}
  </ul>

  {% for asset_ilk in asset_ilks %}
    <div id='{{ asset_ilk }}_container' class='asset_container'>
    </div>
  {% endfor %}

{% endblock content %}
