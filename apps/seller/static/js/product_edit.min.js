function markAssignedAssetsAsSelected(){asset_ids=$("#id_assets").val().split(" "),$.each(asset_ids,function(a,b){if(b!==""){var c=$('[store-input_id="assets"][store-object_id="'+b+'"]');$(c).addClass("active").addClass("selected")}}),color_ids=$("#id_colors").val().split(" "),$.each(color_ids,function(a,b){if(b!==""){var c=$('[store-input_id="colors"][store-object_id="'+b+'"]');$(c).addClass("active").addClass("selected")}}),shipping_option_ids=$("#id_shipping_options").val().split(" "),$.each(shipping_option_ids,function(a,b){if(b!==""){var c=$('[store-input_id="shipping_options"][store-object_id="'+b+'"]');$(c).addClass("active").addClass("selected")}})}function toggleStoreAssetId(a){asset_id=a.attr("store-object_id"),input_element=$("#id_"+a.attr("store-input_id")),input_element_value=input_element.attr("value"),input_element_value===undefined&&(input_element_value=""),a.hasClass("selected")?input_element_value.match(asset_id)||(input_element_value=input_element_value+" "+asset_id,input_element.attr("value",input_element_value)):(input_element_value=input_element_value.replace(asset_id,""),input_element.attr("value",input_element_value)),input_element.trigger("change")}function toggleActiveState(a){asset_input=a.find("input"),a.hasClass("selected")?asset_input.attr("data-status","active"):asset_input.attr("data-status",""),asset_input.trigger("change")}function applyAutosaveDataToTextAttributes(){$(".giveMeData").each(function(){$(this).attr("data-product_id",$("#id_product_id").val()),attribute=$(this).attr("id").replace("id_",""),$(this).attr("data-attribute",attribute)})}function applyAutosaveEvents(){$(".autosave").each(function(){$(this).autosave({url:$("#product-ajax-url").attr("value"),before:function(){$(this).addClass("updating")},success:function(a){$(this).removeClass("updating").addClass("saved"),updateSummary(a)},error:function(){$(this).removeClass("updating").addClass("error")}})})}function fileUploadAction(){this.apply=function(a,b){var c=a,d=b,e=$("#download-url").val()+"_unique_id_.jpg",f=c.closest(".photo-upload-div").find(".progress"),g=c.closest(".photo-upload-div").find(".photo-form");f.hide(),g.show();var h=f.find(".bar"),i=!1,j=f.closest(".photo-upload-div").find(".spinner-div").attr("id"),k=document.getElementById(j),l=new Spinner;c.fileupload({dataType:"json",url:$("#upload-url").val(),submit:function(a,b){var c=f.closest(".photo-upload-div").find(".spinner-div").attr("id"),d=document.getElementById(c);l.spin(d);var g=h.closest(".photo-upload-div").find(".data-form");b.formData=getFormData(g),e=$("#download-url").val()+"_unique_id_.jpg",e=e.replace("_unique_id_",b.formData.public_id)},send:function(a,b){b.dataType.indexOf("iframe")>=0?(i=!0,loadPhoto(f,e,l)):(h.css("width","0%"),f.show(),g.hide())},progress:function(a,b){var c=parseInt(b.loaded/b.total*100,10);h.css("width",c+"%")},done:function(a,b){response_data=b.response(),response=response_data.result,i||(loadThumb(response.url,d),storePhotoURL(response.url,d),l.stop())},always:function(a,b){h.css("width","0%"),f.hide(),g.show()}})}}function getFormData(a){var b={};return $.ajax({async:!1,cache:!1,type:a.attr("method"),url:a.attr("action"),data:a.serialize(),success:function(a){b=a}}),b}function loadPhoto(a,b,c){$.ajax({url:b,processData:!1}).success(function(){display_div=a.closest(".photo-upload-div").find(".photo"),loadThumb(b,display_div),storePhotoURL(b,display_div),c.stop()}).error(function(){setTimeout(function(){loadPhoto(a,b,c)},1e4)})}function loadThumb(a,b){thumb_url=a.replace("upload","upload/c_fill,g_center,h_225,q_85,w_300"),b.html('<img src="'+thumb_url+'">')}function storePhotoURL(a,b){photo_save_input=b.closest(".photo-upload-div").find(".photo-id-save"),photo_save_input.attr("value",a),photo_save_input.trigger("change")}function updateSummary(a){first_photo_url=$("#photo1").closest(".photo-upload-div").find("img").attr("src"),!first_photo_url||($("#summary-section").find(".summary-image").find("img").attr("src",first_photo_url),$("#floating-photo").find(".image").find("img").attr("src",first_photo_url),$("#confirmation").find(".image").find("img").attr("src",first_photo_url)),seller_price=a.summary_price,seller_price!==""&&$("#summary-price").html(seller_price),shipping_cost=a.summary_shipping_cost,parseInt(shipping_cost)!==0?$("#summary-shipping").html(shipping_cost):$("#summary-shipping").html(""),total=parseInt(seller_price)+parseInt(shipping_cost),$("#summary-total").html(total)}function validateForm(){return $(".attention").removeClass("attention"),no_errors=!0,$("#product-chooser-section").find(".selected").length===0&&($("#product-chooser-section").addClass("attention"),no_errors=!1),$("#artisan-chooser-section").find(".selected").length===0&&($("#artisan-chooser-section").addClass("attention"),no_errors=!1),$("#photos").find(".photo").first().find("img").length===0&&($("#photos-section").addClass("attention"),no_errors=!1),$("#id_price").val()>0||($("#price-section").addClass("attention"),no_errors=!1),$("#id_weight").val()>0||($("#measurements-section").addClass("attention"),no_errors=!1),$("#id_shipping_options").val().trim().length===0&&($("#shipping-option-chooser-section").addClass("attention"),no_errors=!1),no_errors||($("#photos").find(".photo-form").click(function(){$(this).closest("photos-section").removeClass("attention")}),$("#product-chooser-section").click(function(){$(this).removeClass("attention")}),$("#artisan-chooser-section").click(function(){$(this).removeClass("attention")}),$("#id_price").click(function(){$(this).closest("#price-section").removeClass("attention")}),$("#id_weight").click(function(){$(this).closest("#measurements-section").removeClass("attention")}),$("#shipping-option-chooser-section").click(function(){$(this).removeClass("attention")})),no_errors}$().ready(function(){num_divs=0,$(".photo-upload-div").each(function(){num_divs+=1,num_divs>5&&$(this).hide()}),$("i").click(function(){$(this).closest("table").find("input").focus()}),$("#id_price, #id_weight, #id_width, #id_height, #id_length").on("focus",function(){$(this).closest("td").next("td").next("td").find("button").css("opacity","1")}),$("#id_price, #id_weight, #id_width, #id_height, #id_length").on("blur",function(){$(this).closest("td").next("td").next("td").find("button").css("opacity","0.01")}),markAssignedAssetsAsSelected(),$(".total-cost").bind("click",function(){$(".extra").toggle()}),$(".asset").each(function(){$(this).bind("click",function(){$(this).toggleClass("active"),$(this).toggleClass("selected"),toggleStoreAssetId($(this)),toggleActiveState($(this))})}),$(".photo-upload-div").each(function(){file_input=$(this).find(".photo-input"),display_div=$(this).find(".photo"),uploader=new fileUploadAction,uploader.apply(file_input,display_div)}),applyAutosaveDataToTextAttributes(),applyAutosaveEvents(),$("#submit").bind("click",function(){validateForm()?$.ajax({url:$("#product-ajax-url").attr("value"),data:{attribute:"active",status:"yes",product_id:$("#product-id").val()}}).success(function(){$("#product-edit-form").hide(),$("#floating-photo").remove(),$("#confirmation").show()}):$("body").scrollTo($(".attention").first(),1100)})}),jQuery.fn.autosave=function(a){function b(a){var b=/^data\-(\w+)$/,d={};return d.value=a.value,d.name=a.name,c.each(a.attributes,function(a,c){b.test(c.nodeName)&&(d[b.exec(c.nodeName)[1]]=c.value)}),d}var c=jQuery;c.each(this,function(){var d=c(this),f={data:{},event:"change",success:function(){},error:function(){},before:function(){}};a=c.extend(f,a);var g=b(this),h=g.event||a.event;d.on(h,function(){var d=c(this);g.value=d.val(),g=c.extend(g,b(this));var f=g.url?g.url:a.url;a.before&&a.before.call(this,d),c.ajax({url:f,data:g,success:function(b){a.success(b,d)},error:function(b){a.error(b,d)}})})})},function(a,b){typeof exports=="object"?module.exports=b():typeof define=="function"&&define.amd?define(b):a.Spinner=b()}(this,function(){function d(a,b){var c=document.createElement(a||"div"),d;for(d in b)c[d]=b[d];return c}function e(a){for(var b=1,c=arguments.length;b<c;b++)a.appendChild(arguments[b]);return a}function g(a,d,e,g){var h=["opacity",d,~~(a*100),e,g].join("-"),i=.01+e/g*100,j=Math.max(1-(1-a)/d*(100-i),a),k=c.substring(0,c.indexOf("Animation")).toLowerCase(),l=k&&"-"+k+"-"||"";return b[h]||(f.insertRule("@"+l+"keyframes "+h+"{"+"0%{opacity:"+j+"}"+i+"%{opacity:"+a+"}"+(i+.01)+"%{opacity:1}"+(i+d)%100+"%{opacity:"+a+"}"+"100%{opacity:"+j+"}"+"}",f.cssRules.length),b[h]=1),h}function h(b,c){var d=b.style,e,f;if(d[c]!==undefined)return c;c=c.charAt(0).toUpperCase()+c.slice(1);for(f=0;f<a.length;f++){e=a[f]+c;if(d[e]!==undefined)return e}}function i(a,b){for(var c in b)a.style[h(a,c)||c]=b[c];return a}function j(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)a[d]===undefined&&(a[d]=c[d])}return a}function k(a){var b={x:a.offsetLeft,y:a.offsetTop};while(a=a.offsetParent)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function m(a){if(typeof this=="undefined")return new m(a);this.opts=j(a||{},m.defaults,l)}function n(){function a(a,b){return d("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)}f.addRule(".spin-vml","behavior:url(#default#VML)"),m.prototype.lines=function(b,c){function g(){return i(a("group",{coordsize:f+" "+f,coordorigin:-d+" "+ -d}),{width:f,height:f})}function l(b,f,h){e(j,e(i(g(),{rotation:360/c.lines*b+"deg",left:~~f}),e(i(a("roundrect",{arcsize:c.corners}),{width:d,height:c.width,left:c.radius,top:-c.width>>1,filter:h}),a("fill",{color:c.color,opacity:c.opacity}),a("stroke",{opacity:0}))))}var d=c.length+c.width,f=2*d,h=-(c.width+c.length)*2+"px",j=i(g(),{position:"absolute",top:h,left:h}),k;if(c.shadow)for(k=1;k<=c.lines;k++)l(k,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(k=1;k<=c.lines;k++)l(k);return e(b,j)},m.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}"use strict";var a=["webkit","Moz","ms","O"],b={},c,f=function(){var a=d("style",{type:"text/css"});return e(document.getElementsByTagName("head")[0],a),a.sheet||a.styleSheet}(),l={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};m.defaults={},j(m.prototype,{spin:function(a){this.stop();var b=this,e=b.opts,f=b.el=i(d(0,{className:e.className}),{position:e.position,width:0,zIndex:e.zIndex}),g=e.radius+e.length+e.width,h,j;a&&(a.insertBefore(f,a.firstChild||null),j=k(a),h=k(f),i(f,{left:(e.left=="auto"?j.x-h.x+(a.offsetWidth>>1):parseInt(e.left,10)+g)+"px",top:(e.top=="auto"?j.y-h.y+(a.offsetHeight>>1):parseInt(e.top,10)+g)+"px"})),f.setAttribute("role","progressbar"),b.lines(f,b.opts);if(!c){var l=0,m=(e.lines-1)*(1-e.direction)/2,n,o=e.fps,p=o/e.speed,q=(1-e.opacity)/(p*e.trail/100),r=p/e.lines;(function s(){l++;for(var a=0;a<e.lines;a++)n=Math.max(1-(l+(e.lines-a)*r)%p*q,e.opacity),b.opacity(f,a*e.direction+m,n,e);b.timeout=b.el&&setTimeout(s,~~(1e3/o))})()}return b},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=undefined),this},lines:function(a,b){function k(a,c){return i(d(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*f+b.rotate)+"deg) translate("+b.radius+"px"+",0)",borderRadius:(b.corners*b.width>>1)+"px"})}var f=0,h=(b.lines-1)*(1-b.direction)/2,j;for(;f<b.lines;f++)j=i(d(),{position:"absolute",top:1+~(b.width/2)+"px",transform:b.hwaccel?"translate3d(0,0,0)":"",opacity:b.opacity,animation:c&&g(b.opacity,b.trail,h+f*b.direction,b.lines)+" "+1/b.speed+"s linear infinite"}),b.shadow&&e(j,i(k("#000","0 0 4px #000"),{top:"2px"})),e(a,e(j,k(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=i(d("group"),{behavior:"url(#default#VML)"});return!h(o,"transform")&&o.adj?n():c=h(o,"animation"),m}),function(a){function c(a){return typeof a=="object"?a:{top:a,left:a}}var b=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};b.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1,limit:!0},b.window=function(b){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return/webkit/i.test(navigator.userAgent)||d.compatMode=="BackCompat"?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){return typeof e=="object"&&(f=e,e=0),typeof f=="function"&&(f={onAfter:f}),d=="max"&&(d=9e9),f=a.extend({},b.defaults,f),e=e||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=c(f.offset),f.over=c(f.over),this._scrollable().each(function(){function o(a){j.animate(m,e,f.easing,a&&function(){a.call(this,d,f)})}if(d==null)return;var i=this,j=a(i),k=d,l,m={},n=j.is("html,body");switch(typeof k){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(k)){k=c(k);break}k=a(k,this);if(!k.length)return;case"object":if(k.is||k.style)l=(k=a(k)).offset()}a.each(f.axis.split(""),function(a,c){var d=c=="x"?"Left":"Top",e=d.toLowerCase(),p="scroll"+d,q=i[p],r=b.max(i,c);if(l)m[p]=l[e]+(n?0:q-j.offset()[e]),f.margin&&(m[p]-=parseInt(k.css("margin"+d))||0,m[p]-=parseInt(k.css("border"+d+"Width"))||0),m[p]+=f.offset[e]||0,f.over[e]&&(m[p]+=k[c=="x"?"width":"height"]()*f.over[e]);else{var s=k[e];m[p]=s.slice&&s.slice(-1)=="%"?parseFloat(s)/100*r:s}f.limit&&/^\d+$/.test(m[p])&&(m[p]=m[p]<=0?0:Math.min(m[p],r)),!a&&f.queue&&(q!=m[p]&&o(f.onAfterFirst),delete m[p])}),o(f.onAfter)}).end()},b.max=function(b,c){var d=c=="x"?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])}}(jQuery)