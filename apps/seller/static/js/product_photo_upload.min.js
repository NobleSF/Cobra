function fileUploadAction(){this.apply=function(a){var b=!1,c=a,d={},e=new Spinner,f=c.closest(".photo-upload-div").find(".spinner-div"),g=c.closest(".photo-upload-div").find(".photo-forms");c.closest(".photo-upload-div").find(".progress").hide(),c.closest(".photo-upload-div").find(".photo-forms").show(),c.fileupload({dataType:"json",url:$("#upload-url").val(),submit:function(a,b){var c=g.find(".data-form");b.formData=getFormData(c),d=b.formData,d.product_id=$(g).find(".product").val(),d.rank=$(g).find(".rank").val()},send:function(a,c){c.dataType.indexOf("iframe")>=0&&(b=!0),c.files[0].name.length>0&&(b?setTimeout(function(){loadPhoto(d)},1e4):($("#progress-bar-"+d.rank).css("width","0%"),$("#progress-"+d.rank).show()),e.spin(document.getElementById($(f).attr("id"))),$(f).show(),g.hide())},progress:function(a,b){var c=parseInt(b.loaded/b.total*95,10);$("#progress-bar-"+d.rank).css("width",c+"%")},done:function(a,c){b||loadPhoto(d)},always:function(a,b){$("#progress-"+d.rank).hide(),e.stop(),g.show()}})}}function getFormData(a){var b={};return $.ajax({async:!1,cache:!1,type:a.attr("method"),url:a.attr("action"),data:a.serialize(),dataType:"json",success:function(a){b=a}}),b}function loadPhoto(a){return $.ajax({async:!1,url:$("#upload-check-url").val(),cache:!1,data:a,dataType:"json"}).done(function(b,c,d){switch(d.status){case 200:$("#photo-"+a.rank).find("img").attr("src",b.thumb_url),$("#progress-"+a.rank).hide(),$("#spinner-"+a.rank).hide(),$("#photo-forms-"+a.rank).show(),updateSummary();break;case 204:setTimeout(function(){loadPhoto(a)},2e3);case 404:}}).fail(function(){}),True}$().ready(function(){$(".photo-upload-div").each(function(){uploader=new fileUploadAction,uploader.apply($(this).find(".photo-input"))})})