function applyAssetAutosave(a){a.find(".autosave").autosave({url:$("#save-asset-url").val(),before:saveAssetBefore,success:saveAssetSuccess,error:saveAssetError})}function saveAssetBefore(a){var b=a.closest(".asset");b.removeClass("empty"),b.removeClass("error"),b.removeClass("saved"),b.addClass("saving"),addAssetForms()}function saveAssetSuccess(a,b){var c=b.closest(".asset");c.removeClass("saving"),c.addClass("saved")}function saveAssetError(a,b){var c=b.closest(".asset");c.removeClass("saving"),c.addClass("error")}function applyAssetDeleteAction(a){a.find(".delete-asset").click(function(){var a=$(this).closest(".asset");a.addClass("soon-dead"),$.ajax({url:$("#delete-asset-url").val(),data:{ilk:a.find("input#id_ilk").val(),rank:a.find("input#id_rank").val()}}).success(function(b){a.slideUp(500,function(){a.remove()})})})}function fileUploadAction(){this.apply=function(a){var b=!1,c=a,d={},e=new Spinner,f=c.closest(".image-upload-div").find(".spinner-div"),g=c.closest(".image-upload-div").find(".image-forms");c.closest(".asset-media").find(".progress").hide(),c.closest(".image-upload-div").find(".image-forms"),c.fileupload({dataType:"json",url:$("#upload-url").val(),submit:function(a,b){var c=g.find(".data-form");b.formData=getFormData(c),d=b.formData,d.ilk=$(g).find(".ilk").val(),d.rank=$(g).find(".rank").val(),d.ilkrank=d.ilk+d.rank},send:function(a,c){c.dataType.indexOf("iframe")>=0&&(b=!0),c.files[0].name.length>0&&(b?setTimeout(function(){loadImage(d)},1e4):($("#progress-bar-"+d.ilkrank).css("width","0%"),$("#progress-"+d.ilkrank).show()),e.spin(document.getElementById($(f).attr("id"))),$(f).show(),g.hide())},progress:function(a,b){var c=parseInt(b.loaded/b.total*95,10);$("#progress-bar-"+d.ilkrank).css("width",c+"%")},done:function(a,c){b||loadImage(d)},always:function(a,b){$("#progress-"+d.ilkrank).hide(),e.stop(),g.show()}})}}function getFormData(a){var b={};return $.ajax({async:!1,cache:!1,type:a.attr("method"),url:a.attr("action"),data:a.serialize(),dataType:"json",success:function(a){b=a}}),b}function loadImage(a){$.ajax({async:!1,url:$("#upload-check-url").val(),cache:!1,data:a,dataType:"json"}).done(function(b,c,d){switch(d.status){case 200:$("#image-"+a.ilkrank).find("img").attr("src",b.thumb_url),$("#progress-"+a.ilkrank).hide(),$("#spinner-"+a.ilkrank).hide(),$("#image-forms-"+a.ilkrank).show(),$("#asset-"+a.ilk+a.rank).removeClass("empty").removeClass("error").addClass("saved"),addAssetForms();break;case 204:setTimeout(function(){loadImage(a)},2e3);case 404:}}).fail(function(){$("#asset-"+a.ilk+a.rank).addClass("error")})}$().ready(function(){$("input,textarea").on("focus",function(){$(this).closest(".asset-fields").find(".go").show(),$(this).closest(".asset-fields").find(".delete-asset").hide()}),$(".go").on("click",function(){$(this).closest(".asset-fields").find(".go").hide()})})