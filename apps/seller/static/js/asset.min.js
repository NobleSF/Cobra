function applyAssetAutosave(a){a.find(".autosave").autosave({url:$("#save-asset-url").val(),before:saveAssetBefore,success:saveAssetSuccess,error:saveAssetError})}function saveAssetBefore(a){var b=a.closest(".asset");b.removeClass("empty"),b.removeClass("error"),b.removeClass("saved"),b.addClass("saving"),addAssetForms()}function saveAssetSuccess(a,b){var c=b.closest(".asset");c.removeClass("saving"),c.addClass("saved")}function saveAssetError(a,b){var c=b.closest(".asset");c.removeClass("saving"),c.addClass("error")}function applyAssetDeleteAction(a){a.find(".delete-asset").click(function(){var a=$(this).closest(".asset");a.addClass("soon-dead"),$.ajax({url:$("#delete-asset-url").val(),data:{ilk:a.find("input#id_ilk").val(),rank:a.find("input#id_rank").val()}}).success(function(b){a.slideUp(500,function(){a.remove()})})})}function fileUploadAction(){this.apply=function(a,b){var c=a,d=b,e=$("#download-url").val()+"_unique_id_.jpg",f=c.closest(".asset-media").find(".progress"),g=c.closest(".image-upload-div").find(".image-form");f.hide(),g.show();var h=f.find(".bar"),i=!1,j=f.closest(".image-upload-div").find(".spinner-div").attr("id"),k=document.getElementById(j),l=new Spinner;c.fileupload({dataType:"json",url:$("#upload-url").val(),submit:function(a,b){var c=f.closest(".image-upload-div").find(".spinner-div").attr("id"),d=document.getElementById(c);l.spin(d);var g=h.closest(".image-upload-div").find(".data-form");b.formData=getFormData(g),e=e.replace("_unique_id_",b.formData.public_id)},send:function(a,b){b.dataType.indexOf("iframe")>=0?(i=!0,setTimeout(function(){loadImage(f,e,l)},2e4)):(h.css("width","0%"),f.show(),g.hide())},progress:function(a,b){var c=parseInt(b.loaded/b.total*100,10);h.css("width",c+"%")},done:function(a,b){response_data=b.response(),response=response_data.result,i||(loadThumb(response.url,d),storeImageURL(response.url,d),l.stop())},always:function(a,b){h.css("width","0%"),f.hide(),g.show()}})}}function getFormData(a){var b={};return $.ajax({async:!1,cache:!1,type:a.attr("method"),url:a.attr("action"),data:a.serialize(),success:function(a){b=a}}),b}function loadImage(a,b,c){$.ajax({url:b,type:"HEAD",cache:!1,processData:!1}).success(function(){display_div=a.closest(".image-upload-div").find(".image"),loadThumb(b,display_div),storeImageURL(b,display_div),c.stop()}).error(function(){setTimeout(function(){loadImage(a,b,c)},5e3)})}function loadThumb(a,b){thumb_url=a.replace("upload","upload/c_fill,g_center,h_225,q_85,w_300"),b.html('<img src="'+thumb_url+'">')}function storeImageURL(a,b){image_save_input=b.closest(".asset").find("#id_image_url"),image_save_input.attr("value",a),image_save_input.trigger("change")}$().ready(function(){})