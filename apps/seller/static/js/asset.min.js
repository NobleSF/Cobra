function applyAssetAutosave(a){a.find(".autosave").autosave({url:$("#save-asset-url").val(),before:saveAssetBefore,success:saveAssetSuccess,error:saveAssetError})}function saveAssetBefore(a){a.closest(".asset").removeClass("error").removeClass("saved").addClass("updating"),a.closest(".asset").find("#id_asset_id").val()=="none"&&(a.closest(".asset").attr("id","asset-pending"),a.closest(".asset").find("#id_asset_id").attr("value","pending"),a.closest(".asset").find(".autosave").attr("data-asset_id","pending"),addAssetForms())}function saveAssetSuccess(a,b){b.closest(".asset").attr("id","asset-"+a.asset_id),b.closest(".asset").find("#id_asset_id").attr("value",a.asset_id),b.closest(".asset").find(".autosave").attr("data-asset_id",a.asset_id),b.closest(".asset").removeClass("updating").removeClass("error").addClass("saved")}function saveAssetError(a,b){b.closest(".asset").find("#id_asset_id").val()=="pending"&&b.closest(".asset").find("#id_asset_id").attr("value","none"),b.closest(".asset").removeClass("updating").addClass("error")}function applyAssetDeleteAction(a){a.find(".delete-asset").click(function(){$(this).closest(".asset").addClass("soon-dead");var a=$(this).closest(".asset").find("#id_asset_id").val();$.ajax({url:$("#delete-asset-url").val(),data:{asset_id:a}}).success(function(a){$("#asset-"+a.asset_id).slideUp(500,function(){$(this).remove()})})})}function fileUploadAction(){this.apply=function(a,b){var c=a,d=b,e=c.closest(".asset, .seller-media").find(".progress");e.hide();var f=e.find(".bar");c.fileupload({dataType:"json",url:$("#upload-url").val(),send:function(a,b){e.show()},progress:function(a,b){var c=parseInt(b.loaded/b.total*100,10);f.css("width",c+"%")},done:function(a,b){response_data=b.response(),response=response_data.result,thumb_url=response.url.replace("upload","upload/c_fill,g_center,h_225,q_85,w_300"),d.html('<img src="'+thumb_url+'">'),image_field=d.closest(".asset, #seller-account").find(".image-url"),image_field.attr("value",response.url).trigger("change"),f.css("width","0%"),e.hide()}})}}$().ready(function(){}),jQuery.fn.autosave=function(a){function b(a){var b=/^data\-(\w+)$/,d={};return d.value=a.value,d.name=a.name,c.each(a.attributes,function(a,c){b.test(c.nodeName)&&(d[b.exec(c.nodeName)[1]]=c.value)}),d}var c=jQuery;c.each(this,function(){var d=c(this),f={data:{},event:"change",success:function(){},error:function(){},before:function(){}};a=c.extend(f,a);var g=b(this),h=g.event||a.event;d.on(h,function(){var d=c(this);g.value=d.val(),g=c.extend(g,b(this));var f=g.url?g.url:a.url;a.before&&a.before.call(this,d),c.ajax({url:f,data:g,success:function(b){a.success(b,d)},error:function(b){a.error(b,d)}})})})}