{% extends "base.html" %}
{% load url from future %}
{% load checkout_inclusion_tags %}

{% block title %}
  Shopping Cart
{% endblock title %}

{% block javascript %}
  <script type="text/javascript" src="{{ STATIC_URL }}public/js/cart.min.js"></script>
  <!-- WEPAY Script -->
  <script type="text/javascript" src="https://www.wepay.com/min/js/iframe.wepay.js"></script>
  {% if cart.count %}
    <script type="text/javascript">
      WePay.iframe_checkout("wepay-payment", "{{ wepay_checkout_uri }}");
    </script>
  {% endif %}
{% endblock javascript %}

{% block css %}
  <link href="{{ STATIC_URL }}public/css/cart.css" rel="stylesheet">
{% endblock css %}

{% block content %}

  <div class='row-fluid'>
    <div id='main-content' class='span8'>

      <!----- PART 1 ----->
      <div id='cart' class='part1'>
        <h3 id='cart-sentance' class='trim'>
          You have
          {{ cart.count }}
          item{{ cart.count|pluralize }}
          in your Shopping Cart.
        </h3>

        <div id='items'>
          {% for item in cart %}
            <div id='item_{{ item.id }}' class='thumbnail row-fluid'>
              <div class='photo span4'>
                <a href="{% url 'product' item.product.id %}">
                  <img src='{{ item.photo.thumb_size }}' alt='{{ item.product.title }}'>
                </a>
              </div>
              <div class='details span8'>
                <ul>
                  <li class='name'>
                    <a href="{% url 'product' item.product.id %}">
                      {{ item.product.name }} by {{ item.product.seller.name }}
                    </a>
                  </li>
                  <li class='price'>${{ item.product.display_price }}</li>
                  <li class='delete'>
                    <a href="{% url 'cart-remove' item.product.id %}">remove</a>
                  </li>
                </ul>
              </div>
            </div>
          {% endfor %}
        </div>

        <div id='summary' class='row-fluid'>
          <div class='span5'>
            <ul>
              <li class='title-font'>Shipping</li>
              <li class='title-font'>Total</li>
              <li class='title-font'><a href="{% url 'home' %}">Continue Shopping</a></li>
            </ul>
          </div>
          <div class='span7'>
            <ul>
              <li class='amount title-font'>0.00</li>
              <li class='amount title-font'>
                $<span id='order-total'>{{ cart.summary }}</span>
              </li>
              <li class='title-font'>
                {% if cart.count %}
                  <button id='checkout-button'
                     class='btn btn-large btn-success'>
                    Secure Checkout
                  </button>
                {% else %}
                  <button id='checkout-button-dummy'
                     class='btn btn-large btn-success disabled'>
                    Secure Checkout
                  </button>
                {% endif %}
              </li>
            </ul>
          </div>
        </div>
      </div>
      <!----- END PART 1 ----->

      <div id='cart-shortcut' class='part2 part3'>
        <h3 id='cart-return-button' class=''>
          <a href='#cart-sentance'>
            <span class='symbol-cart'></span> back to Cart
          </a>
        </h3>

        <h3 id='cart-paragraph' class='trim '>
          You have
          {% for item in cart %}
            {% if forloop.first %}a
            {% elif forloop.last %} and a
            {% else %}, a
            {% endif %}
            {{ item.product.name }}
            for
            ${{ item.product.display_price }}
          {% endfor %}
          in your cart for a total of
          ${{ cart.summary }}
        </h3>
      </div>

      <!----- PART 2 ----->
      <div id='customer-info' class='part2'>
        <div id='checkout-form'>
          <input type='hidden' id='cart-ajax-url' value="{% url 'cart-save' %}">
          <div class='row-fluid'>
            <div class='span6'>
              <fieldset><legend>Contact Info</legend>

                <div class="control-group">
                  <div class="controls">
                    {{ cart_form.name }}
                    <p class="help-inline">Please provide your name.</p>
                  </div>
                </div>

                <div class="control-group">
                  <div class="controls">
                    {{ cart_form.email }}
                    <p id='email-suggestion'>
                      Did you mean <a id='suggested-email'></a>?
                    </p>
                    <p class="help-inline">Please provide your email.</p>
                  </div>
                </div>

              </fieldset>
            </div>
            <div class='span6'>
              <fieldset>
                <legend>Order Total: ${{ cart.summary }}</legend>
                <div class='control-group'>
                  <button id='pay-now-button' class='btn btn-large btn-success'>
                    Pay Now
                  </button>
                </div>
              </fieldset>
              </h3>
            </div>
          </div>
        </div>
      </div>
      <!----- END PART 2 ----->

      <!----- PART 3 ----->
      <div id='payment' class='part3'>
        {% if 'admin_id' in request.session %}
          {% manual_checkout_tag cart %}
        {% else %}
          <small class='trim text-info'>
            <span class='symbol-lock'></span>
            This container is an SSL (https) encrypted frame secured and hosted by
            <a href='https://www.wepay.com/security' target='_blank'>WePay</a>
            <span class='symbol-lock'></span>
          </small>
          <div id='wepay-payment'></div>
          <small class='trim text-info'>
            <span class='symbol-lock'></span>
            This container is an SSL (https) encrypted frame secured and hosted by
            <a href='https://www.wepay.com/security' target='_blank'>WePay</a>
            <span class='symbol-lock'></span>
          </small>
        {% endif %}
      </div>
      <!----- END PART 3 ----->

    </div><!-- end of left side, span8 -->

    <div id='information' class='span4'>
      <div class='well'>
        <h4>How much is Shipping?</h4>
        <p>Shipping is free to the USA, Europe, and Morocco. However, we are exploring the demand for shipping to other countries. Shoot us an email to <a href='mailto:hello@theanou.com'>hello@theanou.com</a> and we'll see what we can do for you!</p>
      </div>
      <div class='well'>
        <h4>What about returns?</h4>
        <p>If you need to return an item for any reason, we will send you a shipping label to cover return shipping and you will receive a full refund. Just email us at <a href='mailto:hello@theanou.com'>hello@theanou.com</a>. As a matter of fact, we haven't even had any returns yet! So we're trusting you on when something needs to be returned.</p>
      </div>
      <div class='well'>
        <h4>Can the shipping and billing address be different?</h4>
        <p>Yes, they can be different. You will have the opportunity to enter them seperately.</p>
      </div>
      <div class='well'>
        <h4>What is your security policy?</h4>
        <p>Our security is the highest possible because we do not handle any of your sensitive personal information. Your payment will be processed by <a href='https://www.wepay.com/security' target='_blank'>WePay</a> through their secure portal. The only information we keep on file is your shipping address so the artisan can mail your order, and your email so we can update you on it's progress.</p>
      </div>
    </div>
  </div>

{% endblock content %}
