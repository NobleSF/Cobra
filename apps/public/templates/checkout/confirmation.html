{% extends "base.html" %}
{% load url from future %}

{% block title %}
  Order Confirmation
{% endblock title %}

{% block javascript %}
  <script type="text/javascript" src="{{ STATIC_URL }}public/js/confirmation.min.js"></script>
{% endblock javascript %}

{% block css %}
  <link href="{{ STATIC_URL }}public/css/confirmation.css" rel="stylesheet">
{% endblock css %}

{% block content %}
  <div class='row-fluid'>
    <div class='span8'>

      {% if cart.count %}
        <div id='comfirmation-title'>
          <h1>
            {% if checkout_data.error or checkout_data.problem %}
              {{ checkout_data.error }}
              {{ checkout_data.problem }}
            {% else %}
              Order Complete!
            {% endif %}
          </h1>
          <h3 class=''>
            {% if checkout_data.gross %}
              Total Charged:
              <span class='badge'><h3 class=''>
                ${{ checkout_data.gross|floatformat:2 }}
              </h3></span>
            {% endif %}
            {% if checkout_data.checkout_id %}
              Confirmation Number:
              <span class='badge'><h3 class=''>
                {{ checkout_data.checkout_id }}
              </h3></span>
            {% endif %}
          </h3>

          {% for item in cart %}
            {% if item.order.tracking_number %}
              <h3 class=''>
                Track your {{ item.product.name }} at
                <a href="{{ item.order.tracking_url }}" target='_blank'>
                  {{ item.order.tracking_number }}
                </a>.
              </h3>
            {% endif %}
          {% endfor %}
        </div>

      {% else %}
        <h3>Oh no, can't find your order!</h3>
      {% endif %}

      <div class='row-fluid'>
        <div id='items' class='span4'>
          <fieldset>
            <legend>Order Items</legend>
            <ul class='unstyled'>
              {% for item in cart %}
                <li>
                  <a href="{{ item.product.get_absolute_url }}">
                    <img class='product-photo'
                         src='{{ item.photo.pinky_size }}' alt='{{ item.product.title }}'>
                    <h5 class='product-title'>
                      {{ item.product.name }}
                      <span class=''>${{ item.product.display_price }}</span>
                    </h5>
                  </a>
                </li>
              {% endfor %}
            </ul>
          </fieldset>
        </div>

        <div id='confirmation-details' class='span8'>
          <fieldset>
            <legend>Contact Information</legend>
            <p>
              {% if checkout_data.name %}
                <span id='subscribe-name'>{{ checkout_data.name }}</span>
              {% else %}
                No name on file.
              {% endif %}
              <br>
              {% if checkout_data.email %}
                <span id='subscribe-email'>{{ checkout_data.email }}</span>
              {% else %}
                No email on file!
              {% endif %}
            </p>
            {% if checkout_data.email %}
              <p id='subscribe' data-url="{% url 'communication:subscribe' %}">
                <button type='button' id='subscribe-submit' class='btn btn-success'>
                  Subscribe
                </button>
                <button type='button' class='btn btn-info disabled'>
                  Saving...
                </button>
                <button type='button' class='btn btn-success disabled'>
                  Thanks!
                </button>
                <span class='before'>to</span>
                <span class='after'>You'll</span>
                receive updates<br>
                as Anou transforms the world of Fair Trade.
              </p>
            {% endif %}
          </fieldset>

          <fieldset>
            <legend>Shipping Address</legend>
            <p>
              {% if checkout_data.shipping_address %}
                {% if checkout_data.shipping_address.name %}
                  {{ checkout_data.shipping_address.name }}<br>
                {% elif checkout_data.name %}
                  {{ checkout_data.name }}<br>
                {% endif %}
                {{ checkout_data.shipping_address.address1|default_if_none:"" }}<br>
                {% if checkout_data.shipping_address.address2 %}
                  {{ checkout_data.shipping_address.address2 }}<br>
                {% endif %}
                {{ checkout_data.shipping_address.city|default_if_none:"" }},
                {{ checkout_data.shipping_address.state|default_if_none:"" }}
                {{ checkout_data.shipping_address.postal_code|default_if_none:"" }}<br>
                {{ checkout_data.shipping_address.country|default_if_none:"" }}
              {% else %}
                No shipping address on file!
              {% endif %}
            </p>
          </fieldset>

          <p class='text-info'>
            If any of the above contact or shipping information is incorrect or missing, please contact us immediately at <a href='mailto:hello@theanou.com'>hello@theanou.com</a> so we can correct it.
          </p>

          <div id='followup'>
            <h3>
              Excited...
              <a href="https://www.facebook.com/sharer/sharer.php?u=www.theanou.com" target="_blank">
                <img src="{{ STATIC_URL }}images/buttons/FB_share_Anou.png"
                     title='Share Anou on Facebook'
                     width='200'
                     height='52'>
               </a>
            </h3>
            <h3>
              Read the
              <a href='http://helloanou.wordpress.com'>latest blog post</a>
              by founder, Dan Driscoll
            </h3>
          </div>
        </div>
      </div>
    </div><!-- end of left side, span8 -->

    <div id='information' class='span4'>
      <div class='well'>
        <h4>When will my order arrive ?</h4>
        <p>Shipping from rural Morocco can take from 10 to 28 days, but we'll keep you updated on your order's progress by email.</p>
      </div>
      <div class='well'>
        <h4>What about returns ?</h4>
        <p>If you need to return part or all of your order for any reason, we will send you a shipping label to cover return shipping. You will be fully refunded for any returned items. Email us at <a href='mailto:hello@theanou.com'>hello@theanou.com</a>, we are happy to assist you.</p>
      </div>
      <div class='well'>
        <h4>How can Anou be improved ?</h4>
        <p>We genuinely want you to have a positive buying experience every time and would love to hear from you. Please write to <a href='mailto:hello@theanou.com'>hello@theanou.com</a>. Whether it's praise or criticism, it's like opening a gift when we get to hear from our customers!</p>
      </div>
      <div class='well'>
        <h4>What can I do to help ?</h4>
        <p>When your purchase arrives, pleas send us a picture or post it to our <a href="http://www.facebook.com/TheAn0u">Facebook page</a>. Our artisans always love to see how you are using their products so they can improve their designs.</p>
      </div>
    </div>
  </div>

  <div id='data' class='hidden'>
    <h1>Wepay Data:</h1>
    <ul>
      {% for key,value in checkout_data.items %}
        <li>{{key}}: {{value}}</li>
      {% endfor %}
    </ul>
  </div>

{% endblock content %}
