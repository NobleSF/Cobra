{% extends "base.html" %}
{% load url from future %}
{% load cache %}

{% cache 86400 public_product_content product.id product.is_sold product.approved_at %}

{% block title %}
  {{ product.name }} by {{ product.seller.name }}
{% endblock title %}

{%block open_graph_type%}product{%endblock%}
{%block open_graph_url%}http://www.theanou.com{% url 'product' product.id %}{%endblock%}
{%block open_graph_title%}{{ product.name }} by {{ product.seller.name }}{%endblock%}
{%block open_graph_description%}{{ product.description|truncatewords:"25" }}{%endblock%}
{%block open_graph_image%}{{ product.photos.0.thumb_size }}{%endblock%}

{% block additional_meta_tags %}
  <meta property="product:price:amount"           content="{{ product.display_price }}" />
  <meta property="product:price:currency"         content="USD" />
  <meta property="product:shipping_cost:amount"   content="0.00" />
  <meta property="product:shipping_cost:currency" content="USD" />
{% endblock additional_meta_tags %}

{% block javascript %}
  <script type="text/javascript" src="{{ STATIC_URL }}public/js/product.min.js"></script>
{% endblock javascript %}

{% block css %}
  <link href="{{ STATIC_URL }}public/css/product.css" rel="stylesheet">
{% endblock css %}

{% block content %}
  <div id='product' class='row-fluid'>
    <div class='span8'>
      <div id='photos' class='carousel slide'>
        <ol class='carousel-indicators'></ol>
        <!-- Carousel items -->
        <div class='carousel-inner'>
          {% for photo in product.photos %}
            <div class='item {% if forloop.first %}active{% endif %}'>
              <img src='{{ photo.product_size }}' alt='product photo {{ photo.rank }}'>
              <!--<div class='carousel-caption'></div>-->
            </div>
          {% endfor %}
        </div>
        <!-- Carousel nav -->
        <a class="carousel-control left" href="#photos" data-slide="prev">&lsaquo;</a>
        <a class="carousel-control right" href="#photos" data-slide="next">&rsaquo;</a>
      </div>

      <div id='pinkies' class='visible-desktop'>
        <ul class='thumbnails'>
          {% for photo in product.photos %}
            <li>
              <img class='thumbnail {% if forloop.first %}active{% endif %}'
                   data-target='#photos' data-slide-to='{{ forloop.counter0 }}'
                   src='{{ photo.pinky_size }}'>
            </li>
          {% endfor %}
        </ul>
      </div>

      <div id='product-description'>
        <p>
          <span class='title'>{{ product.name }}</span>
          {{ product.description }}
        </p>

        {% if product.english_dimensions %}
          <p>
            <span class='title'>Approx. Size</span>
            <span class='nowrap'>{{ product.english_dimensions }}</span>
            <span class='title'>or</span>
            <span class='nowrap'>{{ product.metric_dimensions }}</span>
          </p>
        {% endif %}
      </div>

    </div>
    <!--
    <div id='ratings' class='span4 well well-small'>
      {% for rating in '123' %}
        <div class='rating'>
          {% for star in '12345' %}
            <i class="icon-star-empty"></i>
          {% endfor %}
          <span class='rating-subject'>Rating Subject</span>
        </div>
      {% endfor %}
    </div>
    -->

    <div id='actions' class='span4'>
      <table id='buying-table'>

        <tr id='faceboook' class='text-center' style='margin: 1em 1em 0;'>
          <div class="fb-like visible-desktop"
               data-href="http://www.theanou.com{% url 'product' product.id %}"
               data-width="250" data-layout="standard"
               data-show-faces="false" data-send="true">
          </div>
          <div class="fb-like visible-tablet"
               data-href="http://www.theanou.com{% url 'product' product.id %}"
               data-width="100" data-layout="button_count"
               data-show-faces="false" data-send="true">
          </div>
        </tr>

        <tr>
          <td rowspan=2 class='price'>${{ product.display_price }}</td>
          <td class='price-qualifier'>free shipping.</td>
        </tr>
        <tr>
          <td class='price-qualifier'>free returns.</td>
        </tr>
      </table>
      {% if product.is_sold %}
        <a id='buy-button' class='btn btn-primary btn-danger disabled'
           href="">
          <h2>
            {% if product.recently_sold %}
              Sorry, this product just sold today.
            {% else %}Sold
            {% endif %}
          </h2>
        </a>
      {% else %}
        <a id='buy-button' class='btn btn-primary btn-success'
           href="{% url 'cart-add' product.id %}">
          <h2>Add To Cart</h2>
        </a>
      {% endif %}
    </div>

    <div id='artisan' class='span4'>
      <img id='artisan-image' src='{{ product.artisan.image.thumb_size }}'>
      {% if product.artisan.name %}
        <p>handmade by</p>
        <h3 id='artisan-name'>{{ product.artisan.name }}</h3>
        <p>at</p>
      {% else %}
        <p>handmade at</p>
      {% endif %}
      <h3 id='store-name'>
        <a href="{% url 'store' product.seller.id %}">
          {{ product.seller.name }}
        </a>
      </h3>
      <p id='artisan-bio'>
        {% if product.artisan.description %}
          <span class='short-description'>
            {{ product.artisan.description|truncatewords:"20" }}
          </span>
          <small class='read-more'>read more</small>
          <span class='long-description'>
            {{ product.artisan.description }}
          </span>
        {% endif %}
      </p>
    </div>

  </div>

  {% if product.utilities %}
    <h4 class='utilities-disclaimer'>
      This original item was uniquely handmade using the local materials and tools below
    </h4>
  {% endif %}

  <div id='utilities'><div class='row-fluid'>
    {% for utility in product.utilities %}
      <div class='utility span6'>
        <table>
          <tr>
            <td class='utility-image-space'>
              {% if utility.image %}
                <img class='small-utility-image' src='{{ utility.image.pinky_size }}'>
              {% endif %}
            </td>
            <td>
              {% if utility.name %}
                <h4>{{ utility.name }}</h4>
              {% endif %}

              {% if utility.description %}
                <p class='utility-description'>
                  <span class='short-description'>
                    {{ utility.description|truncatewords:"6" }}
                  </span>
                  <small class='read-more'>read more</small>
                  <span class='long-description'>
                    {{ utility.description }}
                  </span>
                </p>
              {% endif %}
            </td>
          </tr>
        </table>
      </div>

      {% cycle "" "</div><div id='utilities' class='row-fluid'>"%}

    {% endfor %}
  </div></div>
  <hr>

  {% load home_inclusion_tags %}
  <div id='store'>
    <h1 class='text-center'>
      <a href="{% url 'store' product.seller.id %}">
        <small>more from</small> {{ product.seller.name }}
      </a>
      {% if product.seller.image %}
        <img src='{{ product.seller.image.pinky_size }}'>
      {% endif %}
    </h1>

    <div class='product-row row-fluid'>
      {% for product in more_products %}

        <div class='span4 product-area {% cycle "pos1" "pos2" "pos3" %}'>
          {% product_tag product %}
        </div>

        {% cycle "" "" "</div><div class='product-row row-fluid'>" %}
      {% endfor %}
    </div>
  </div>

{% endblock content %}
{% endcache %}
