(function(a){"use strict";var b=function(a,c,d){var e=document.createElement("img"),f,g;e.onerror=c,e.onload=function(){g&&(!d||!d.noRevoke)&&b.revokeObjectURL(g),c&&c(b.scale(e,d))};if(b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))f=g=b.createObjectURL(a),e._type=a.type;else if(typeof a=="string")f=a,d&&d.crossOrigin&&(e.crossOrigin=d.crossOrigin);else return!1;return f?(e.src=f,e):b.readFile(a,function(a){var b=a.target;b&&b.result?e.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.detectSubsampling=function(a){var b,c;return a.width*a.height>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-a.width+1,0),c.getImageData(0,0,1,1).data[3]===0):!1},b.detectVerticalSquash=function(a,b){var c=document.createElement("canvas"),d=c.getContext("2d"),e,f,g,h,i;c.width=1,c.height=b,d.drawImage(a,0,0),e=d.getImageData(0,0,1,b).data,f=0,g=b,h=b;while(h>f)i=e[(h-1)*4+3],i===0?g=h:f=h,h=g+f>>1;return h/b||1},b.renderImageToCanvas=function(a,c,d,e,f,g,h,i,j,k){var l=a.getContext("2d"),m=document.createElement("canvas"),n=m.width=m.height=1024,o=m.getContext("2d"),p,q,r;l.save(),b.detectSubsampling(c)&&(f/=2,g/=2),p=b.detectVerticalSquash(c,g),j=Math.ceil(n*j/f),k=Math.ceil(n*k/g/p),i=0,r=0;while(r<g){h=0,q=0;while(q<f)o.clearRect(0,0,n,n),o.drawImage(c,d,e,f,g,-q,-r,f,g),l.drawImage(m,0,0,n,n,h,i,j,k),q+=n,h+=j;r+=n,i+=k}l.restore()},b.scale=function(a,c){c=c||{};var d=document.createElement("canvas"),e=a.getContext||(c.canvas||c.crop)&&d.getContext,f=a.width,g=a.height,h=c.maxWidth,i=c.maxHeight,j=f,k=g,l=0,m=0,n=0,o=0,p,q,r;return e&&h&&i&&c.crop?(p=h,q=i,f/g<h/i?(k=i*f/h,m=(g-k)/2):(j=h*g/i,l=(f-j)/2)):(p=f,q=g,r=Math.max((c.minWidth||p)/p,(c.minHeight||q)/q),r>1&&(p=Math.ceil(p*r),q=Math.ceil(q*r)),r=Math.min((h||p)/p,(i||q)/q),r<1&&(p=Math.ceil(p*r),q=Math.ceil(q*r))),e?(d.width=p,d.height=q,a._type==="image/jpeg"?b.renderImageToCanvas(d,a,l,m,j,k,n,o,p,q):d.getContext("2d").drawImage(a,l,m,j,k,n,o,p,q),d):(a.width=p,a.height=q,a)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b){if(window.FileReader&&FileReader.prototype.readAsDataURL){var c=new FileReader;return c.onload=c.onerror=b,c.readAsDataURL(a),c}return!1},typeof define=="function"&&define.amd?define(function(){return b}):a.loadImage=b})(this)